<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 패널 - SEO 색인 도구</title>
    <!-- Google API 스크립트 추가 -->
    <script src="https://apis.google.com/js/api.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .admin-content {
            padding: 30px;
        }

        .admin-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #dc3545;
        }

        .admin-section h3 {
            color: #dc3545;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .password-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .password-section h3 {
            color: #856404;
        }

        .current-password {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ffc107;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .password-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            font-weight: bold;
            color: #856404;
        }

        .copy-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }

        .copy-btn:hover {
            background: #e0a800;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #dc3545;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .members-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .members-table th,
        .members-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .members-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .login-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 400px;
            text-align: center;
        }

        .login-box h2 {
            color: #dc3545;
            margin-bottom: 20px;
        }

        .recent-activity {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .activity-item {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #6c757d;
        }
      
         .drive-status {
                    background: white;
                    padding: 15px;
                    border-radius: 8px;
                    margin-bottom: 15px;
                    border: 2px solid #17a2b8;
                }

                .drive-connected {
                    color: #28a745;
                    font-weight: bold;
                }

                .drive-disconnected {
                    color: #dc3545;
                    font-weight: bold;
                }

                .drive-actions, .drive-settings {
                    display: flex;
                    gap: 10px;
                    margin-bottom: 15px;
                    flex-wrap: wrap;
                }

                .drive-info {
                    background: #e7f3ff;
                    padding: 15px;
                    border-radius: 8px;
                    border-left: 4px solid #17a2b8;
                }

                .drive-info h4 {
                    color: #17a2b8;
                    margin-bottom: 10px;
                }

                .drive-info ul {
                    margin: 0;
                    padding-left: 20px;
                }

                .drive-info li {
                    margin-bottom: 5px;
                    color: #495057;
                }

                .drive-setup {
                    border-left: 4px solid #ffc107;
                }

                .drive-setup h4 {
                    color: #856404;
                    margin-bottom: 10px;
                }

                .drive-setup a {
                    color: #856404;
                    text-decoration: underline;
                }

                /* 가이드 섹션 스타일 */
                .collapsible-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    cursor: pointer;
                    padding: 10px 0;
                    border-bottom: 2px solid #dc3545;
                }

                .collapsible-header:hover {
                    background: rgba(220, 53, 69, 0.1);
                    padding: 10px;
                    border-radius: 5px;
                    margin: -10px;
                }

                .toggle-icon {
                    font-size: 1.2rem;
                    font-weight: bold;
                    color: #dc3545;
                    transition: transform 0.3s ease;
                }

                .toggle-icon.rotated {
                    transform: rotate(180deg);
                }

                .collapsible-content {
                    margin-top: 20px;
                }

                .guide-section {
                    background: white;
                    padding: 20px;
                    border-radius: 8px;
                    margin-bottom: 20px;
                    border-left: 4px solid #007bff;
                }

                .guide-section h4 {
                    color: #007bff;
                    margin-bottom: 15px;
                    font-size: 1.2rem;
                }

                .guide-steps {
                    margin-left: 10px;
                }

                .step {
                    margin-bottom: 15px;
                    padding: 10px;
                    background: #f8f9fa;
                    border-radius: 5px;
                    border-left: 3px solid #28a745;
                }

                .step strong {
                    color: #28a745;
                }

                .step code {
                    background: #e9ecef;
                    padding: 2px 6px;
                    border-radius: 3px;
                    font-family: 'Courier New', monospace;
                    color: #dc3545;
                }

                .step small {
                    color: #6c757d;
                    display: block;
                    margin-top: 5px;
                }

                #memberInstructions {
                    width: 100%;
                    background: #f8f9fa;
                    border: 2px solid #dc3545;
                    border-radius: 5px;
                    padding: 15px;
                    font-family: 'Courier New', monospace;
                    font-size: 0.9rem;
                    line-height: 1.4;
                    resize: vertical;
                }

                /* 백업 상태 메시지 */
                .backup-status {
                    background: #e3f2fd;
                    border: 1px solid #2196f3;
                    border-radius: 8px;
                    padding: 15px;
                    margin: 15px 0;
                    font-size: 14px;
                }

                .backup-status.success {
                    background: #e8f5e8;
                    border-color: #4caf50;
                    color: #2e7d32;
                }

                .backup-status.error {
                    background: #ffeaea;
                    border-color: #f44336;
                    color: #c62828;
                }

                .backup-status.loading {
                    background: #fff3e0;
                    border-color: #ff9800;
                    color: #ef6c00;
                }

                @media (max-width: 768px) {
                    .drive-actions, .drive-settings {
                        flex-direction: column;
                    }
                    
                    .drive-actions button, .drive-settings button {
                        width: 100%;
                    }
                }
    </style>
</head>
<body>
    <!-- 로그인 섹션 -->
    <div class="login-section" id="loginSection">
        <div class="login-box">
            <h2>🔒 관리자 로그인</h2>
            <div class="form-group">
                <label for="adminPassword">관리자 비밀번호</label>
                <input type="password" id="adminPassword" placeholder="관리자 비밀번호를 입력하세요">
            </div>
            <button class="btn btn-danger" onclick="adminLogin()">로그인</button>
        </div>
    </div>

    <!-- 관리자 패널 -->
    <div class="container" id="adminPanel" style="display: none;">
        <div class="header">
            <h1>🛠️ 관리자 패널</h1>
            <p>SEO 색인 도구 관리 시스템</p>
          <button class="btn btn-secondary" onclick="adminLogout()" style="float: right; margin-top: -30px;">🚪 로그아웃</button>
        </div>

        <div class="admin-content">
            <!-- 통계 섹션 -->
            <div class="admin-section">
                <h3>📊 서비스 현황</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMembers">0</div>
                        <div class="stat-label">총 멤버</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingMembers">0</div>
                        <div class="stat-label">승인 대기</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayJoins">0</div>
                        <div class="stat-label">오늘 가입</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeUsers">0</div>
                        <div class="stat-label">활성 사용자</div>
                    </div>
                </div>
            </div>

            <!-- 암호 관리 섹션 -->
            <div class="admin-section password-section">
                <h3>🔑 인증 암호 관리</h3>
                <div class="current-password">
                    <div>
                        <strong>현재 인증 암호:</strong>
                        <span class="password-display" id="currentPassword">2024-SEO-TOOL</span>
                    </div>
                    <button class="copy-btn" onclick="copyPassword()">📋 복사</button>
                </div>
                <div class="form-group">
                    <label for="newPassword">새 암호</label>
                    <input type="text" id="newPassword" placeholder="새로운 인증 암호를 입력하세요">
                </div>
                <button class="btn btn-warning" onclick="changePassword()">암호 변경</button>
                <button class="btn btn-secondary" onclick="generatePassword()">자동 생성</button>
                
                <div class="recent-activity">
                    <h4>최근 암호 변경 이력</h4>
                    <div class="activity-item">
                        <span>2024-SEO-TOOL</span>
                        <span class="activity-time">2024-05-22 13:30</span>
                    </div>
                    <div class="activity-item">
                        <span>2024-MIDDLE-AGE</span>
                        <span class="activity-time">2024-05-20 09:15</span>
                    </div>
                </div>
            </div>

            <!-- 멤버 관리 섹션 -->
            <div class="admin-section">
                <h3>👥 멤버 관리</h3>
                <div style="margin-bottom: 15px;">
                    <button class="btn btn-success" onclick="refreshMembers()">🔄 새로고침</button>
                    <button class="btn btn-warning" onclick="exportMembers()">📤 멤버 목록 내보내기</button>
                </div>
                
                <table class="members-table">
                    <thead>
                        <tr>
                            <th>닉네임</th>
                            <th>상태</th>
                            <th>신청일</th>
                            <th>관리</th>
                        </tr>
                    </thead>
                    <tbody id="membersTableBody">
                        <tr>
                            <td>중년라이프</td>
                            <td><span class="status-badge status-pending">대기중</span></td>
                            <td>2024-05-22 13:45</td>
                            <td>
                                <button class="btn btn-success" onclick="approveMember('user1')">승인</button>
                                <button class="btn btn-danger" onclick="rejectMember('user1')">거부</button>
                            </td>
                        </tr>
                        <tr>
                            <td>블로그마스터</td>
                            <td><span class="status-badge status-approved">승인됨</span></td>
                            <td>2024-05-21 10:30</td>
                            <td>
                                <button class="btn btn-secondary" onclick="blockMember('user2')">차단</button>
                            </td>
                        </tr>
                        <tr>
                            <td>SEO전문가</td>
                            <td><span class="status-badge status-approved">승인됨</span></td>
                            <td>2024-05-20 16:20</td>
                            <td>
                                <button class="btn btn-secondary" onclick="blockMember('user3')">차단</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 시스템 관리 섹션 -->
            <div class="admin-section">
                <h3>⚙️ 시스템 관리</h3>
                <div style="margin-bottom: 15px;">
                    <button class="btn btn-warning" onclick="backupData()">💾 데이터 백업</button>
                    <button class="btn btn-secondary" onclick="viewLogs()">📋 로그 보기</button>
                    <button class="btn btn-danger" onclick="emergencyStop()">🚨 긴급 정지</button>
                </div>
                
                <div class="recent-activity">
                    <h4>최근 활동 로그</h4>
                    <div class="activity-item">
                        <span>새 멤버 가입: 중년라이프</span>
                        <span class="activity-time">방금 전</span>
                    </div>
                    <div class="activity-item">
                        <span>멤버 승인: 블로그마스터</span>
                        <span class="activity-time">1시간 전</span>
                    </div>
                    <div class="activity-item">
                        <span>암호 변경</span>
                        <span class="activity-time">2시간 전</span>
                    </div>
                </div>
            </div>
                 
            <!-- 구글 드라이브 백업 섹션 -->
            <div class="admin-section">
                <h3>☁️ 구글 드라이브 백업</h3>
                
                <div class="drive-status">
                    <div class="status-item">
                        <span>드라이브 연결 상태:</span>
                        <span id="driveStatus" class="drive-disconnected">연결 안됨</span>
                    </div>
                    <div class="status-item">
                        <span>자동 백업:</span>
                        <span id="autoBackupStatus">설정 확인 중...</span>
                    </div>
                </div>

                <!-- 백업 상태 메시지 -->
                <div id="backupStatus" class="backup-status">
                    백업 기능을 사용하려면 먼저 구글 드라이브에 연결하세요.
                </div>
                
                <div class="drive-actions">
                    <button class="btn btn-primary" onclick="signInToDrive()">🔑 드라이브 로그인</button>
                    <button class="btn btn-success" onclick="backupToGoogleDrive()" id="backupButton" disabled>☁️ 드라이브 백업</button>
                    <button class="btn btn-info" onclick="exportMembersToGoogleDrive()" id="exportButton" disabled>📤 멤버목록 업로드</button>
                </div>
                
                <div class="drive-settings">
                    <button class="btn btn-secondary" id="autoBackupBtn" onclick="toggleAutoBackup()">
                        ⏸️ 자동백업 꺼짐
                    </button>
                    <button class="btn btn-secondary" onclick="openDriveBackupFolder()">📁 백업폴더 열기</button>
                </div>
                
                <div class="drive-info">
                    <h4>💡 구글 드라이브 백업 장점</h4>
                    <ul>
                        <li>✅ 자동 클라우드 백업 (15GB 무료)</li>
                        <li>✅ 언제 어디서나 접근 가능</li>
                        <li>✅ 버전 관리 자동</li>
                        <li>✅ 실수로 삭제해도 복구 가능</li>
                        <li>✅ "SEO도구백업" 폴더에 정리</li>
                    </ul>
                </div>
                
                <div class="drive-setup" style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                    <h4>⚙️ 드라이브 API 설정 (최초 1회)</h4>
                    <p><small>
                        1. <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a> 접속<br>
                        2. Drive API 활성화<br>
                        3. OAuth 클라이언트 ID 생성<br>
                        4. 아래 JavaScript 코드에서 API 키 설정<br>
                        <br>
                        <strong>⚠️ 설정 필요:</strong><br>
                        <code>const DRIVE_CLIENT_ID = '실제-클라이언트-ID';</code><br>
                        <code>const BACKUP_FOLDER_ID = '1cYBfIxSffRcHzBONnxgaNVXxTF_FF4GQ';</code>
                    </small></p>
                </div>
            </div>

            <!-- API 설정 가이드 섹션 (접이식) -->
            <div class="admin-section">
                <div class="collapsible-header" onclick="toggleGuide()">
                    <h3>📚 API 설정 가이드 (멤버 안내용)</h3>
                    <span class="toggle-icon" id="guideToggle">▼</span>
                </div>
                
                <div class="collapsible-content" id="guideContent" style="display: none;">
                    
                    <!-- Google Search Console -->
                    <div class="guide-section">
                        <h4>🔵 Google Search Console API 발급</h4>
                        <div class="guide-steps">
                            <div class="step">
                                <strong>1단계:</strong> Google Cloud Console 접속<br>
                                <code>https://console.cloud.google.com</code>
                                <button class="copy-btn" onclick="copyText('https://console.cloud.google.com')">복사</button>
                            </div>
                            <div class="step">
                                <strong>2단계:</strong> 새 프로젝트 생성<br>
                                <small>프로젝트 이름: "SEO 색인 도구" (원하는 이름)</small>
                            </div>
                            <div class="step">
                                <strong>3단계:</strong> API 라이브러리에서 Search Console API 활성화<br>
                                <small>좌측 메뉴 → API 및 서비스 → 라이브러리 → "Search Console" 검색</small>
                            </div>
                            <div class="step">
                                <strong>4단계:</strong> OAuth 클라이언트 ID 생성<br>
                                <small>사용자 인증 정보 → 사용자 인증 정보 만들기 → OAuth 클라이언트 ID</small>
                            </div>
                            <div class="step">
                                <strong>5단계:</strong> 웹 애플리케이션 선택 후 설정<br>
                                <strong>승인된 리디렉션 URI:</strong><br>
                                <code>https://sabrina242.github.io/search-engine-indexing-tool</code>
                                <button class="copy-btn" onclick="copyText('https://sabrina242.github.io/search-engine-indexing-tool')">복사</button>
                            </div>
                            <div class="step">
                                <strong>6단계:</strong> Client ID와 Client Secret 복사 보관
                            </div>
                        </div>
                    </div>

                    <!-- Bing Webmaster Tools -->
                    <div class="guide-section">
                        <h4>🟦 Bing Webmaster Tools API 발급</h4>
                        <div class="guide-steps">
                            <div class="step">
                                <strong>1단계:</strong> Bing Webmaster Tools 접속<br>
                                <code>https://www.bing.com/webmasters</code>
                                <button class="copy-btn" onclick="copyText('https://www.bing.com/webmasters')">복사</button>
                            </div>
                            <div class="step">
                                <strong>2단계:</strong> Microsoft 계정으로 로그인
                            </div>
                            <div class="step">
                                <strong>3단계:</strong> 사이트 추가 및 소유권 확인
                            </div>
                            <div class="step">
                                <strong>4단계:</strong> API 액세스 키 요청<br>
                                <small>설정 → API 키 관리에서 발급</small>
                            </div>
                        </div>
                    </div>

                    <!-- 네이버 서치어드바이저 -->
                    <div class="guide-section">
                        <h4>🟢 네이버 서치어드바이저 API 발급</h4>
                        <div class="guide-steps">
                            <div class="step">
                                <strong>1단계:</strong> 네이버 개발자센터 접속<br>
                                <code>https://developers.naver.com</code>
                                <button class="copy-btn" onclick="copyText('https://developers.naver.com')">복사</button>
                            </div>
                            <div class="step">
                                <strong>2단계:</strong> 네이버 계정 로그인
                            </div>
                            <div class="step">
                                <strong>3단계:</strong> 애플리케이션 등록<br>
                                <small>Application → 애플리케이션 등록</small>
                            </div>
                            <div class="step">
                                <strong>4단계:</strong> 서비스 API 선택<br>
                                <small>검색 → 서치어드바이저 API 선택</small>
                            </div>
                            <div class="step">
                                <strong>5단계:</strong> Client ID와 Client Secret 발급
                            </div>
                        </div>
                    </div>

                    <!-- 멤버용 안내문 -->
                    <div class="guide-section">
                        <h4>📋 카톡방 공유용 안내문</h4>
                        <textarea id="memberInstructions" rows="15" readonly>
🔧 SEO 색인 도구 API 설정 방법

📌 Google Search Console API 발급:
1. https://console.cloud.google.com 접속
2. 새 프로젝트 생성
3. API 라이브러리 → Search Console API 활성화
4. OAuth 클라이언트 ID 생성 (웹 애플리케이션)
5. 리디렉션 URI: https://sabrina242.github.io/search-engine-indexing-tool
6. Client ID, Secret 복사

📌 Bing Webmaster Tools:
1. https://www.bing.com/webmasters 접속
2. 사이트 추가 후 API 키 발급

📌 네이버 서치어드바이저:
1. https://developers.naver.com 접속
2. 애플리케이션 등록 → 서치어드바이저 API
3. Client ID, Secret 발급

❓ 어려우시면 카톡방에서 개별 문의하세요!
                        </textarea>
                        <button class="copy-btn" onclick="copyInstructions()">📋 전체 안내문 복사</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== 기본 변수 설정 =====
        let membersData = [
            {id: 1, nickname: '중년라이프', status: 'pending', joinDate: '2024-05-22', lastActive: '2024-05-22', requestCount: 0},
            {id: 2, nickname: '블로그마스터', status: 'approved', joinDate: '2024-05-21', lastActive: '2024-05-23', requestCount: 15},
            {id: 3, nickname: 'SEO전문가', status: 'approved', joinDate: '2024-05-20', lastActive: '2024-05-23', requestCount: 23}
        ];

        // ===== 구글 드라이브 API 설정 =====
        // ⚠️ 여기를 실제 값으로 교체하세요!
        const DRIVE_CLIENT_ID = 'YOUR_GOOGLE_DRIVE_CLIENT_ID.googleusercontent.com'; // 실제 클라이언트 ID
        const BACKUP_FOLDER_ID = '1cYBfIxSffRcHzBONnxgaNVXxTF_FF4GQ'; // 백업 폴더 ID
        const DRIVE_SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let gapiInited = false;
        let gisInited = false;
        let authInstance = null;

        // ===== 페이지 로드 시 초기화 =====
        document.addEventListener('DOMContentLoaded', function() {
            // Google API 초기화
            if (typeof gapi !== 'undefined') {
                initializeGoogleDrive();
            } else {
                console.log('Google API 로딩 중...');
                updateBackupStatus('Google API 로딩 중...', 'loading');
            }
        });

        // ===== 관리자 로그인 =====
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'admin123') {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadDashboard();
            } else {
                alert('잘못된 비밀번호입니다.');
            }
        }

        function adminLogout() {
            document.getElementById('loginSection').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
        }

        // ===== 대시보드 로드 =====
        function loadDashboard() {
            document.getElementById('totalMembers').textContent = membersData.length;
            document.getElementById('pendingMembers').textContent = membersData.filter(m => m.status === 'pending').length;
            document.getElementById('todayJoins').textContent = '2';
            document.getElementById('activeUsers').textContent = membersData.filter(m => m.status === 'approved').length;
        }

        // ===== 암호 관리 기능 =====
        function copyPassword() {
            const password = document.getElementById('currentPassword').textContent;
            navigator.clipboard.writeText(password);
            alert('암호가 복사되었습니다: ' + password);
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            if (!newPassword) {
                alert('새 암호를 입력해주세요.');
                return;
            }
            
            document.getElementById('currentPassword').textContent = newPassword;
            document.getElementById('newPassword').value = '';
            alert('암호가 변경되었습니다: ' + newPassword);
        }

        function generatePassword() {
            const today = new Date();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const randomNum = Math.floor(Math.random() * 1000);
            
            const newPassword = `2024${month}${day}-${randomNum}`;
            document.getElementById('newPassword').value = newPassword;
        }

        // ===== 멤버 관리 기능 =====
        function approveMember(userId) {
            if (confirm('이 멤버를 승인하시겠습니까?')) {
                alert('멤버가 승인되었습니다.');
                refreshMembers();
            }
        }

        function rejectMember(userId) {
            if (confirm('이 멤버를 거부하시겠습니까?')) {
                alert('멤버가 거부되었습니다.');
                refreshMembers();
            }
        }

        function blockMember(userId) {
            if (confirm('이 멤버를 차단하시겠습니까?')) {
                alert('멤버가 차단되었습니다.');
                refreshMembers();
            }
        }

        function refreshMembers() {
            alert('멤버 목록이 새로고침되었습니다.');
            loadDashboard();
        }

        function exportMembers() {
            alert('멤버 목록이 다운로드됩니다.');
        }

        // ===== 시스템 관리 기능 =====
        function backupData() {
            if (confirm('데이터를 백업하시겠습니까?')) {
                alert('데이터 백업이 완료되었습니다.');
            }
        }

        function viewLogs() {
            alert('로그 보기 기능은 준비 중입니다.');
        }

        function emergencyStop() {
            if (confirm('서비스를 긴급 정지하시겠습니까?')) {
                alert('서비스가 긴급 정지되었습니다.');
            }
        }

        // ===== 구글 드라이브 백업 기능 =====
        
        // Google API 초기화
        async function initializeGoogleDrive() {
            try {
                updateBackupStatus('🔄 Google API 초기화 중...', 'loading');

                // GAPI 초기화
                await new Promise((resolve, reject) => {
                    if (typeof gapi === 'undefined') {
                        reject(new Error('Google API 라이브러리가 로드되지 않았습니다.'));
                        return;
                    }
                    
                    gapi.load('auth2:client', {
                        callback: resolve,
                        onerror: reject
                    });
                });

                // 클라이언트 초기화
                await gapi.client.init({
                    clientId: DRIVE_CLIENT_ID,
                    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                    scope: DRIVE_SCOPES
                });

                authInstance = gapi.auth2.getAuthInstance();
                gapiInited = true;

                // 자동 로그인 체크
                if (authInstance.isSignedIn.get()) {
                    onDriveSignedIn();
                } else {
                    updateBackupStatus('✅ Google API 준비 완료. 로그인해주세요.', 'info');
                    updateDriveStatus('준비됨');
                }

            } catch (error) {
                console.error('Google Drive 초기화 실패:', error);
                updateBackupStatus('❌ Google API 초기화 실패: ' + error.message, 'error');
                updateDriveStatus('초기화 실패');
            }
        }

        // 드라이브 로그인
        async function signInToDrive() {
            try {
                if (!gapiInited) {
                    throw new Error('Google API가 초기화되지 않았습니다.');
                }

                if (DRIVE_CLIENT_ID === 'YOUR_GOOGLE_DRIVE_CLIENT_ID.googleusercontent.com') {
                    alert('⚠️ 먼저 DRIVE_CLIENT_ID를 설정해주세요!\n\n코드에서 다음 부분을 수정하세요:\nconst DRIVE_CLIENT_ID = "실제-클라이언트-ID";');
                    return;
                }

                updateBackupStatus('🔑 구글 계정으로 로그인 중...', 'loading');

                if (!authInstance.isSignedIn.get()) {
                    await authInstance.signIn();
                }

                onDriveSignedIn();

            } catch (error) {
                console.error('드라이브 로그인 실패:', error);
                updateBackupStatus('❌ 로그인 실패: ' + error.message, 'error');
            }
        }

        // 로그인 성공 처리
        function onDriveSignedIn() {
            updateBackupStatus('✅ 구글 드라이브 로그인 성공!', 'success');
            updateDriveStatus('로그인됨');
            
            // 백업 버튼들 활성화
            document.getElementById('backupButton').disabled = false;
            document.getElementById('exportButton').disabled = false;
        }

        // 드라이브 상태 업데이트
        function updateDriveStatus(status) {
            const statusElement = document.getElementById('driveStatus');
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.className = (status === '로그인됨' || status === '연결됨') ? 'drive-connected' : 'drive-disconnected';
            }
        }

        // 백업 상태 메시지 업데이트
        function updateBackupStatus(message, type = 'info') {
            const statusElement = document.getElementById('backupStatus');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = 'backup-status';
                
                if (type === 'success') {
                    statusElement.classList.add('success');
                } else if (type === 'error') {
                    statusElement.classList.add('error');
                } else if (type === 'loading') {
                    statusElement.classList.add('loading');
                }
            }
        }

        // 백업 폴더 찾기 또는 생성
        async function getOrCreateBackupFolder() {
            const folderName = 'SEO도구백업';
            
            try {
                // 기존 폴더 검색
                const response = await gapi.client.drive.files.list({
                    q: `name='${folderName}' and mimeType='application/vnd.google-apps.folder'`,
                    fields: 'files(id, name)'
                });
                
                if (response.result.files.length > 0) {
                    return response.result.files[0].id;
                }
                
                // 폴더가 없으면 생성
                const folderResponse = await gapi.client.drive.files.create({
                    resource: {
                        name: folderName,
                        mimeType: 'application/vnd.google-apps.folder'
                    }
                });
                
                return folderResponse.result.id;
                
            } catch (error) {
                console.error('백업 폴더 생성/찾기 실패:', error);
                throw error;
            }
        }

        // 구글 드라이브에 파일 업로드
        async function uploadToDrive(content, fileName, mimeType = 'application/json') {
            try {
                const folderId = await getOrCreateBackupFolder();
                
                const fileMetadata = {
                    name: fileName,
                    parents: [folderId]
                };
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
                form.append('file', new Blob([content], {type: mimeType}));
                
                const accessToken = authInstance.currentUser.get().getAuthResponse().access_token;
                
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    },
                    body: form
                });
                
                if (response.ok) {
                    return await response.json();
                } else {
                    throw new Error(`업로드 실패: ${response.status}`);
                }
                
            } catch (error) {
                console.error('드라이브 업로드 실패:', error);
                throw error;
            }
        }

        // 구글 드라이브에 백업
        async function backupToGoogleDrive() {
            try {
                if (!authInstance || !authInstance.isSignedIn.get()) {
                    alert('먼저 구글 드라이브에 로그인해주세요.');
                    return;
                }

                updateBackupStatus('📦 백업 데이터 준비 중...', 'loading');

                const backupData = {
                    metadata: {
                        version: '1.0',
                        timestamp: new Date().toISOString(),
                        exportDate: new Date().toLocaleString('ko-KR'),
                        description: 'SEO 색인 도구 관리자 백업'
                    },
                    members: membersData,
                    settings: {
                        currentPassword: document.getElementById('currentPassword')?.textContent || '',
                        autoBackupEnabled: localStorage.getItem('autoBackupEnabled') === 'true'
                    },
                    stats: {
                        totalMembers: membersData.length,
                        pendingMembers: membersData.filter(m => m.status === 'pending').length,
                        approvedMembers: membersData.filter(m => m.status === 'approved').length
                    }
                };

                const fileName = `admin-backup-${new Date().toISOString().split('T')[0]}-${Date.now()}.json`;
                const content = JSON.stringify(backupData, null, 2);

                updateBackupStatus('☁️ 구글 드라이브에 업로드 중...', 'loading');

                await uploadToDrive(content, fileName, 'application/json');

                updateBackupStatus(`✅ 백업 완료! 파일: ${fileName}`, 'success');

            } catch (error) {
                console.error('백업 실패:', error);
                updateBackupStatus('❌ 백업 실패: ' + error.message, 'error');
            }
        }

        // 멤버 목록을 구글 드라이브에 업로드
        async function exportMembersToGoogleDrive() {
            try {
                if (!authInstance || !authInstance.isSignedIn.get()) {
                    alert('먼저 구글 드라이브에 로그인해주세요.');
                    return;
                }

                updateBackupStatus('📤 멤버 목록 준비 중...', 'loading');

                const headers = ['ID', '닉네임', '상태', '가입일', '마지막활동', '요청횟수'];
                const csvContent = [
                    headers.join(','),
                    ...membersData.map(member => [
                        member.id,
                        member.nickname,
                        member.status === 'approved' ? '승인됨' : member.status === 'pending' ? '대기중' : member.status,
                        member.joinDate,
                        member.lastActive,
                        member.requestCount
                    ].join(','))
                ].join('\n');

                const fileName = `members-${new Date().toISOString().split('T')[0]}.csv`;

                updateBackupStatus('☁️ 구글 드라이브에 업로드 중...', 'loading');

                await uploadToDrive(csvContent, fileName, 'text/csv');

                updateBackupStatus(`✅ 멤버 목록 업로드 완료! 파일: ${fileName}`, 'success');

            } catch (error) {
                console.error('멤버 목록 업로드 실패:', error);
                updateBackupStatus('❌ 업로드 실패: ' + error.message, 'error');
            }
        }

        // 백업 폴더 열기
        function openDriveBackupFolder() {
            window.open(`https://drive.google.com/drive/folders/${BACKUP_FOLDER_ID}`, '_blank');
        }

        // 자동 백업 토글
        function toggleAutoBackup() {
            const current = localStorage.getItem('autoBackupEnabled') === 'true';
            const newState = !current;
            
            localStorage.setItem('autoBackupEnabled', newState.toString());
            
            const button = document.getElementById('autoBackupBtn');
            if (button) {
                button.textContent = newState ? '🔄 자동백업 켜짐' : '⏸️ 자동백업 꺼짐';
                button.className = newState ? 'btn btn-success' : 'btn btn-secondary';
            }
            
            alert(newState ? 
                '✅ 자동 백업이 활성화되었습니다!\n매일 구글 드라이브에 백업됩니다.' : 
                '⏸️ 자동 백업이 비활성화되었습니다.'
            );
        }

        // ===== 가이드 섹션 기능 =====
        function toggleGuide() {
            const content = document.getElementById('guideContent');
            const icon = document.getElementById('guideToggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '▲';
                icon.classList.add('rotated');
            } else {
                content.style.display = 'none';
                icon.textContent = '▼';
                icon.classList.remove('rotated');
            }
        }

        function copyText(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('복사되었습니다: ' + text);
            });
        }

        function copyInstructions() {
            const instructions = document.getElementById('memberInstructions').value;
            navigator.clipboard.writeText(instructions).then(function() {
                alert('전체 안내문이 복사되었습니다!\n카톡방에 붙여넣기 하세요.');
            });
        }

     // ===== Google API 강제 로드 및 백업 기능 =====
// 기존 script 태그 맨 아래에 이 코드를 추가하세요

// 구글 드라이브 API 설정
const DRIVE_CLIENT_ID = 'YOUR_GOOGLE_DRIVE_CLIENT_ID.googleusercontent.com'; // 실제 값으로 교체
const BACKUP_FOLDER_ID = '1cYBfIxSffRcHzBONnxgaNVXxTF_FF4GQ';
const DRIVE_SCOPES = 'https://www.googleapis.com/auth/drive.file';

let gapiReady = false;
let authInstance = null;

// 백업 상태 업데이트 함수
function updateBackupStatus(message, type = 'info') {
    const statusElement = document.getElementById('backupStatus');
    if (statusElement) {
        statusElement.textContent = message;
        statusElement.className = 'backup-status';
        if (type === 'success') statusElement.classList.add('success');
        else if (type === 'error') statusElement.classList.add('error');
        else if (type === 'loading') statusElement.classList.add('loading');
    }
    console.log(`[백업] ${message}`);
}

// 드라이브 상태 업데이트 함수
function updateDriveStatus(status) {
    const statusElement = document.getElementById('driveStatus');
    if (statusElement) {
        statusElement.textContent = status;
        statusElement.className = (status === '로그인됨' || status === '연결됨') ? 'drive-connected' : 'drive-disconnected';
    }
}

// Google API 강제 로드 함수
function forceLoadGoogleAPI() {
    return new Promise((resolve, reject) => {
        // 기존 스크립트들 제거
        const existingScripts = document.querySelectorAll('script[src*="apis.google.com"]');
        existingScripts.forEach(script => {
            console.log('기존 Google API 스크립트 제거');
            script.remove();
        });
        
        // gapi 객체 제거
        if (window.gapi) {
            delete window.gapi;
        }
        
        console.log('새로운 Google API 로드 시작...');
        updateBackupStatus('🔄 Google API 로드 중...', 'loading');
        
        const script = document.createElement('script');
        script.src = 'https://apis.google.com/js/api.js';
        script.async = true;
        
        script.onload = () => {
            console.log('Google API 스크립트 다운로드 완료');
            
            // gapi 객체 생성 대기
            let attempts = 0;
            const maxAttempts = 20; // 10초
            
            const checkGapi = () => {
                attempts++;
                
                if (typeof window.gapi !== 'undefined') {
                    console.log('✅ Google API 준비 완료!');
                    gapiReady = true;
                    updateBackupStatus('✅ Google API 준비 완료', 'success');
                    updateDriveStatus('준비됨');
                    resolve();
                } else if (attempts < maxAttempts) {
                    setTimeout(checkGapi, 500);
                } else {
                    console.log('❌ Google API 초기화 시간 초과');
                    updateBackupStatus('❌ Google API 로드 실패', 'error');
                    reject('Google API 초기화 실패');
                }
            };
            
            checkGapi();
        };
        
        script.onerror = (error) => {
            console.log('❌ Google API 로드 실패');
            updateBackupStatus('❌ Google API 로드 실패', 'error');
            reject(error);
        };
        
        document.head.appendChild(script);
    });
}

// Google Drive 초기화
async function initGoogleDrive() {
    try {
        if (!gapiReady) {
            await forceLoadGoogleAPI();
        }
        
        updateBackupStatus('🔄 Google Drive 클라이언트 초기화...', 'loading');
        
        await new Promise((resolve, reject) => {
            gapi.load('auth2:client', {
                callback: resolve,
                onerror: reject
            });
        });
        
        await gapi.client.init({
            clientId: DRIVE_CLIENT_ID,
            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
            scope: DRIVE_SCOPES
        });
        
        authInstance = gapi.auth2.getAuthInstance();
        
        if (authInstance.isSignedIn.get()) {
            onDriveSignedIn();
        } else {
            updateBackupStatus('✅ 드라이브 로그인 준비 완료', 'success');
            updateDriveStatus('로그인 필요');
        }
        
    } catch (error) {
        console.error('Google Drive 초기화 실패:', error);
        updateBackupStatus('❌ 드라이브 초기화 실패: ' + error.message, 'error');
    }
}

// 드라이브 로그인
async function signInToDrive() {
    try {
        if (!gapiReady) {
            alert('Google API가 아직 준비되지 않았습니다. 잠시 후 다시 시도해주세요.');
            return;
        }
        
        if (DRIVE_CLIENT_ID === 'YOUR_GOOGLE_DRIVE_CLIENT_ID.googleusercontent.com') {
            alert('⚠️ 구글 클라이언트 ID 설정이 필요합니다!\n\n코드에서 다음 부분을 수정하세요:\nconst DRIVE_CLIENT_ID = "실제-클라이언트-ID";');
            return;
        }
        
        updateBackupStatus('🔑 구글 계정 로그인 중...', 'loading');
        
        if (!authInstance.isSignedIn.get()) {
            await authInstance.signIn();
        }
        
        onDriveSignedIn();
        
    } catch (error) {
        console.error('로그인 실패:', error);
        updateBackupStatus('❌ 로그인 실패: ' + error.message, 'error');
    }
}

// 로그인 성공 처리
function onDriveSignedIn() {
    updateBackupStatus('✅ 구글 드라이브 로그인 성공!', 'success');
    updateDriveStatus('로그인됨');
    
    // 백업 버튼들 활성화
    const backupButton = document.getElementById('backupButton');
    const exportButton = document.getElementById('exportButton');
    if (backupButton) backupButton.disabled = false;
    if (exportButton) exportButton.disabled = false;
}

// 구글 드라이브에 백업
async function backupToGoogleDrive() {
    try {
        if (!authInstance || !authInstance.isSignedIn.get()) {
            alert('먼저 구글 드라이브에 로그인해주세요.');
            return;
        }
        
        updateBackupStatus('📦 백업 데이터 준비 중...', 'loading');
        
        const backupData = {
            metadata: {
                version: '1.0',
                timestamp: new Date().toISOString(),
                exportDate: new Date().toLocaleString('ko-KR'),
                description: 'SEO 색인 도구 관리자 백업'
            },
            settings: {
                currentPassword: document.getElementById('currentPassword')?.textContent || '',
                totalMembers: document.getElementById('totalMembers')?.textContent || '0',
                pendingMembers: document.getElementById('pendingMembers')?.textContent || '0'
            }
        };
        
        const fileName = `admin-backup-${new Date().toISOString().split('T')[0]}-${Date.now()}.json`;
        const content = JSON.stringify(backupData, null, 2);
        
        updateBackupStatus('☁️ 구글 드라이브 업로드 중...', 'loading');
        
        await uploadToDrive(content, fileName);
        
        updateBackupStatus(`✅ 백업 완료! 파일: ${fileName}`, 'success');
        
    } catch (error) {
        console.error('백업 실패:', error);
        updateBackupStatus('❌ 백업 실패: ' + error.message, 'error');
    }
}

// 멤버 목록 내보내기
async function exportMembersToGoogleDrive() {
    try {
        if (!authInstance || !authInstance.isSignedIn.get()) {
            alert('먼저 구글 드라이브에 로그인해주세요.');
            return;
        }
        
        updateBackupStatus('📤 멤버 목록 준비 중...', 'loading');
        
        const csvData = [
            ['닉네임', '상태', '가입일'],
            ['중년라이프', '대기중', '2024-05-22'],
            ['블로그마스터', '승인됨', '2024-05-21'],
            ['SEO전문가', '승인됨', '2024-05-20']
        ];
        
        const csvContent = csvData.map(row => row.join(',')).join('\n');
        const fileName = `members-${new Date().toISOString().split('T')[0]}.csv`;
        
        updateBackupStatus('☁️ 구글 드라이브 업로드 중...', 'loading');
        
        await uploadToDrive(csvContent, fileName, 'text/csv');
        
        updateBackupStatus(`✅ 멤버 목록 업로드 완료!`, 'success');
        
    } catch (error) {
        console.error('업로드 실패:', error);
        updateBackupStatus('❌ 업로드 실패: ' + error.message, 'error');
    }
}

// 드라이브에 파일 업로드
async function uploadToDrive(content, fileName, mimeType = 'application/json') {
    const fileMetadata = {
        name: fileName,
        parents: [BACKUP_FOLDER_ID]
    };
    
    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
    form.append('file', new Blob([content], {type: mimeType}));
    
    const accessToken = authInstance.currentUser.get().getAuthResponse().access_token;
    
    const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${accessToken}`
        },
        body: form
    });
    
    if (!response.ok) {
        throw new Error(`업로드 실패: ${response.status}`);
    }
    
    return response.json();
}

// 백업 폴더 열기
function openDriveBackupFolder() {
    window.open(`https://drive.google.com/drive/folders/${BACKUP_FOLDER_ID}`, '_blank');
}

// 자동 백업 토글
function toggleAutoBackup() {
    const current = localStorage.getItem('autoBackupEnabled') === 'true';
    const newState = !current;
    
    localStorage.setItem('autoBackupEnabled', newState.toString());
    
    const button = document.getElementById('autoBackupBtn');
    if (button) {
        button.textContent = newState ? '🔄 자동백업 켜짐' : '⏸️ 자동백업 꺼짐';
        button.className = newState ? 'btn btn-success' : 'btn btn-secondary';
    }
    
    alert(newState ? '✅ 자동 백업 활성화됨' : '⏸️ 자동 백업 비활성화됨');
}

// 기존 함수들 재정의 (호환성 보장)
window.backupAllData = function() {
    console.log('backupAllData 호출됨');
    if (gapiReady && authInstance && authInstance.isSignedIn.get()) {
        backupToGoogleDrive();
    } else {
        alert('구글 드라이브 백업을 위해서는 먼저 로그인이 필요합니다.');
    }
};

// 페이지 로드 완료 후 Google API 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('✅ 구글 드라이브 백업 시스템 로드됨');
    
    // 3초 후 Google API 초기화 시도
    setTimeout(() => {
        forceLoadGoogleAPI()
            .then(() => {
                console.log('Google API 자동 로드 성공');
            })
            .catch(error => {
                console.log('Google API 자동 로드 실패, 수동 로그인 필요');
            });
    }, 3000);
});

console.log('🚀 구글 드라이브 백업 기능 설치 완료');
    </script>
</body>
</html>